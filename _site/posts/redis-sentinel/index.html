<!DOCTYPE html>







<html lang="en"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    <!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now">

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="redis的哨兵" />
<meta name="author" content="zwtisme" />
<meta property="og:locale" content="en" />
<meta name="description" content="介绍使用redis哨兵进行自动故障转移" />
<meta property="og:description" content="介绍使用redis哨兵进行自动故障转移" />
<link rel="canonical" href="http://localhost:4000/posts/redis-sentinel/" />
<meta property="og:url" content="http://localhost:4000/posts/redis-sentinel/" />
<meta property="og:site_name" content="Chirpy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-09T15:30:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="redis的哨兵" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@zwtisme" />
<script type="application/ld+json">
{"headline":"redis的哨兵","dateModified":"2022-01-18T00:56:38+08:00","datePublished":"2018-10-09T15:30:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/redis-sentinel/"},"author":{"@type":"Person","name":"zwtisme"},"@type":"BlogPosting","url":"http://localhost:4000/posts/redis-sentinel/","description":"介绍使用redis哨兵进行自动故障转移","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>redis的哨兵 | Chirpy
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<!-- <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"> -->
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon.ico">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Chirpy">
<meta name="application-name" content="Chirpy">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  

  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
          <img src="/img/avatar-hux.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Chirpy</a>
    </div>
    <div class="site-subtitle font-italic">A text-focused Jekyll theme</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <!-- 
  <div class="profile-wrapper text-center">
    <div class="site-title mt-3">
      <span>友情链接</span>
    </div>
  </div>
  <ul class="w-100">
      
      <li class="nav-item active">
        <a class="nav-link" href="http://www.ruanyifeng.com/home.html">阮一峰的个人网站</a>
      </li>
      
      <li class="nav-item active">
        <a class="nav-link" href="https://www.zhangxinxu.com/">张鑫旭的个人主页</a>
      </li>
      
  </ul>
   -->

  <div class="profile-wrapper text-center">
    <div class="site-title mt-3">
      <span><!-- cloud music -->
<!-- auto=1 可以控制自动播放与否，当值为 1 即打开网页就自动播放，值为 0 时需要访客手动点击播放 -->
<iframe frameborder="no" border="1" width=230 height=77 margin="0 auto"
        src="https://music.163.com/outchain/player?type=2&id=1807491207&auto=0&height=66">
</iframe></span>
    </div>
  </div>
  

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>redis的哨兵</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <!-- <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span> -->
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        



<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  




<!-- return -->







<h1 data-toc-skip>redis的哨兵</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>
    
    

    

    By
    <em>
      
        <a href="https://twitter.com/username">your_full_name</a>
      
    </em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago"
    date="2018-10-09 15:30:00 +0800"
    
      data-toggle="tooltip"
      data-placement="bottom"
      title="Tue, Oct  9, 2018,  3:30 PM +0800"
    >Oct  9, 2018</em>

      </span>

      <!-- lastmod date -->
      
      <span>
        Updated
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago"
    date="2022-01-18 00:56:38 +0800
"
    
      data-toggle="tooltip"
      data-placement="bottom"
      title="Tue, Jan 18, 2022, 12:56 AM +0800"
    >Jan 18</em>

      </span>
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="3127 words">
  <em>17 min</em> read</span>


      <!-- page views -->
      
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <blockquote>
  <p>介绍使用redis哨兵进行自动故障转移</p>
</blockquote>

<h2 id="前言">前言 <a href="#前言" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>
为了增强缓存服务器的高可用可使用redis的哨兵监控，来实现主节点发生故障时的自动转移。
</p>

<h2 id="准备工作">准备工作 <a href="#准备工作" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>
由于机器的限制，此文章中的redis实例都是在一台机器上启动的，通过不同的port来模拟不同的redis实例。
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ps -ef|grep redis
root      4104     1  0 13:14 ?        00:00:00 ./redis-server *:6380    
root      4113     1  0 13:18 ?        00:00:00 ./redis-server *:6381    
root      4121     1  0 13:19 ?        00:00:00 ./redis-server *:6382    
root      4129     1  0 13:19 ?        00:00:00 ./redis-server *:6383 
</pre></td></tr></tbody></table></code></div></div>

<h2 id="配置文件">配置文件 <a href="#配置文件" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>
哨兵节点对应的配置文件为<code>sentinel.conf</code>，有如下一些配置项
</p>

<table border="1" cellpadding="0" cellspacing="0" style="width:700px">
	<tbody>
		<tr>
			<td>名称</td>
			<td>说明</td>
			<td>可选值</td>
		</tr>
		<tr>
			<td>bind</td>
			<td>允许访问节点的ip<br />
			protected-mode=yes时设置</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>protected-mode</td>
			<td>保护模式<br />
			设置为no，确保网络在内网环境</td>
			<td>yes|no</td>
		</tr>
		<tr>
			<td>port</td>
			<td>端口</td>
			<td>整数</td>
		</tr>
		<tr>
			<td>daemonize</td>
			<td>守护进程</td>
			<td>yes|no</td>
		</tr>
		<tr>
			<td>pidfile</td>
			<td>进程文件</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>logfile</td>
			<td>日志文件</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>sentinel announce-ip</td>
			<td colspan="1" rowspan="2">对外宣称ip或port</td>
			<td colspan="1" rowspan="2">自定义</td>
		</tr>
		<tr>
			<td>sentinel announce-port</td>
		</tr>
		<tr>
			<td>dir</td>
			<td>工作目录</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>sentinel monitor<br />
			&lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</td>
			<td>监控的主节点<br />
			quorum：<br />
			1.至少有quorum个哨兵节点认为不可达，才会故障转移<br />
			2.至少有max(quorum,num(哨兵个数)/2+1)个哨兵节点参与选举才能进行故障转移</td>
			<td>整数</td>
		</tr>
		<tr>
			<td>sentinel auth-pass<br />
			&lt;master-name&gt; &lt;password&gt;</td>
			<td>主节点密码</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>sentinel down-after-milliseconds<br />
			&lt;master-name&gt; &lt;milliseconds&gt;</td>
			<td>节点不可达的判断时间</td>
			<td>整数</td>
		</tr>
		<tr>
			<td>sentinel parallel-syncs<br />
			&lt;master-name&gt; &lt;numreplicas&gt;</td>
			<td>新主节点出来后，同时有几个从节点进行复制操作</td>
			<td>整数</td>
		</tr>
		<tr>
			<td>sentinel failover-timeout<br />
			&lt;master-name&gt; &lt;milliseconds&gt;</td>
			<td>故障转移超时时间</td>
			<td>整数</td>
		</tr>
		<tr>
			<td>sentinel notification-script<br />
			&lt;master-name&gt; &lt;script-path&gt;</td>
			<td>配置脚本记录故障转移期间的事件</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>sentinel client-reconfig-script<br />
			&lt;master-name&gt; &lt;script-path&gt;</td>
			<td>配置脚本记录故障转移结束后的处理结果</td>
			<td>自定义</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
		</tr>
	</tbody>
</table>

<p>
如果想动态的调整配置，可通过如下命令
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sentinel set &lt;param&gt; &lt;value&gt;
</pre></td></tr></tbody></table></code></div></div>

<table border="1" cellpadding="0" cellspacing="0" style="width:700px">
	<tbody>
		<tr>
			<td>参数</td>
			<td>使用方法</td>
		</tr>
		<tr>
			<td>quorum</td>
			<td>sentinel set master1 quorum 2</td>
		</tr>
		<tr>
			<td>auth-pass</td>
			<td>sentinel set master1 auth-pass password</td>
		</tr>
		<tr>
			<td>down-after-milliseconds</td>
			<td>sentinel set master1 down-after-milliseconds 1000</td>
		</tr>
		<tr>
			<td>parallel-syncs</td>
			<td>sentinel set master1 parallel-syncs 1</td>
		</tr>
		<tr>
			<td>failover-timeout</td>
			<td>sentinel set master1 failover-timeout&nbsp;5000</td>
		</tr>
		<tr>
			<td>notification-script</td>
			<td>sentinel set master1 notification-script&nbsp;/x.sh</td>
		</tr>
		<tr>
			<td>client-reconfig-script</td>
			<td>sentinel set master1 client-reconfig-script&nbsp;/y.sh</td>
		</tr>
	</tbody>
</table>

<p>
在调整配置时需要注意以下几点：
</p>

<ul>
  <li>只对当前调整的节点有效</li>
  <li>配置调整成功会直接刷新配置文件</li>
  <li>所有的哨兵节点配置最好是一致的</li>
</ul>

<h2 id="部署">部署 <a href="#部署" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<h4 id="拓扑结构">拓扑结构 <a href="#拓扑结构" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p>
这里以1个主节点，3个从节点，4个哨兵节点来组成一个Redis Sentinel。
</p>

<p><img data-src="http://localhost:4000/img/2018-10-09-redis-sentinel/20181009135214.png?raw=https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images@f4e0354b674f65a53b8917f0f786ed2956898cc1true" alt="image" data-proofer-ignore></p>

<h4 id="数据节点">数据节点 <a href="#数据节点" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<h5 id="主节点">主节点 <a href="#主节点" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
主要配置如下：
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>#6380
#端口
port 6380
#守护进程
daemonize yes
#rdb文件
dbfilename "dump.rdb"
#工作目录
dir "./"
#日志文件
logfile "redis-server.log"
</pre></td></tr></tbody></table></code></div></div>

<p>
主节点启动
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6380]# ./redis-server redis.conf 

#检查服务状态
[root@vagrant redis-6380]# ps -ef|grep redis
root      4156     1  0 14:07 ?        00:00:00 ./redis-server *:6380    
</pre></td></tr></tbody></table></code></div></div>

<h5 id="从节点">从节点 <a href="#从节点" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
主要配置如下，增加了slaveof配置：
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>#6381,6382,6383
#端口
port 6381
#守护进程
daemonize yes
#rdb文件
dbfilename "dump.rdb"
#工作目录
dir "./"
#日志文件
logfile "redis-server.log"
#设置复制主节点
slaveof 127.0.0.1 6380
</pre></td></tr></tbody></table></code></div></div>

<p>
从节点启动
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6381]# ./redis-server redis.conf 
[root@vagrant redis-6382]# ./redis-server redis.conf 
[root@vagrant redis-6383]# ./redis-server redis.conf 

#检查服务状态
[root@vagrant redis-6383]# ps -ef|grep redis
root      4156     1  0 14:07 ?        00:00:00 ./redis-server *:6380    
root      4164     1  0 14:13 ?        00:00:00 ./redis-server *:6381    
root      4175     1  0 14:14 ?        00:00:00 ./redis-server *:6382    
root      4183     1  0 14:15 ?        00:00:00 ./redis-server *:6383    
</pre></td></tr></tbody></table></code></div></div>

<h5 id="主从关系">主从关系 <a href="#主从关系" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
主节点视角：
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 6380 info replication
# Replication
role:master
connected_slaves:3
slave0:ip=127.0.0.1,port=6381,state=online,offset=210,lag=1
slave1:ip=127.0.0.1,port=6382,state=online,offset=210,lag=1
slave2:ip=127.0.0.1,port=6383,state=online,offset=210,lag=1
</pre></td></tr></tbody></table></code></div></div>

<p>
从节点视角：
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 6381 info replication
# Replication
role:slave
master_host:127.0.0.1
master_port:6380
master_link_status:up
</pre></td></tr></tbody></table></code></div></div>

<h4 id="哨兵节点">哨兵节点 <a href="#哨兵节点" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<h5 id="哨兵配置">哨兵配置 <a href="#哨兵配置" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>#26380,26381,26382,26383
#端口
port 26380
#守护进程
daemonize yes
#工作目录
dir "./"
#日志文件
logfile "redis-sentinel.log"
#监控的主节点
sentinel monitor master1 127.0.0.1 6380 2
#节点不可达判断时间
sentinel down-after-milliseconds master1 1000
#同时向新主节点发起复制操作的节点个数
sentinel parallel-syncs master1 1
#故障转移超时时间
sentinel failover-timeout master1 5000
</pre></td></tr></tbody></table></code></div></div>

<p>
<font color="red">
Tips：不要手动设置sentinel myid值，此值会自动生成
</font>
</p>

<h5 id="哨兵启动">哨兵启动 <a href="#哨兵启动" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6380]# ./redis-sentinel sentinel.conf 
[root@vagrant redis-6381]# ./redis-sentinel sentinel.conf 
[root@vagrant redis-6382]# ./redis-sentinel sentinel.conf 
[root@vagrant redis-6383]# ./redis-sentinel sentinel.conf 
</pre></td></tr></tbody></table></code></div></div>

<h5 id="配置变化">配置变化 <a href="#配置变化" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
当哨兵节点都启动完成后，配置文件会被自动修改掉。
</p>

<p>
减少的配置：
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sentinel parallel-syncs master1 1
</pre></td></tr></tbody></table></code></div></div>

<p>
增加的配置：
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>#最后的数字表示是第几次进行故障转移
sentinel config-epoch master1 0
sentinel leader-epoch master1 0
#自动发现3个从节点
sentinel known-slave master1 127.0.0.1 6382
sentinel known-slave master1 127.0.0.1 6383
sentinel known-slave master1 127.0.0.1 6381
#自动发现除自身的3个哨兵节点
sentinel known-sentinel master1 127.0.0.1 26381 29e2457f28a8fecd77f253b542f10523878c4e59
sentinel known-sentinel master1 127.0.0.1 26380 699c1928d7ebe3b9f3a8395e824313e1e8f66a7e
sentinel known-sentinel master1 127.0.0.1 26382 8b1933d36031e2b9ee581f8269ac4bd427bb6063
sentinel current-epoch 0
</pre></td></tr></tbody></table></code></div></div>

<h5 id="哨兵确认">哨兵确认 <a href="#哨兵确认" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
检查哨兵的状态是否与配置的一致
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 info sentinel
# Sentinel
sentinel_masters:1
sentinel_tilt:0
sentinel_running_scripts:0
sentinel_scripts_queue_length:0
sentinel_simulate_failure_flags:0
master0:name=master1,status=ok,address=127.0.0.1:6380,slaves=3,sentinels=4
</pre></td></tr></tbody></table></code></div></div>
<h2 id="api">API <a href="#api" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>
哨兵节点作为一个特殊的redis节点，有如下一些专属的api
</p>

<h5 id="sentinel-masters">sentinel masters <a href="#sentinel-masters" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
查看所有被监控的主节点信息
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel masters
1)  1) "name"
    2) "master1"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "6382"
    ...
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-master-">sentinel master <master name=""></master> <a href="#sentinel-master-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
查看某个主节点的信息
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel master master1
 1) "name"
 2) "master1"
 3) "ip"
 4) "127.0.0.1"
 5) "port"
 6) "6382"
 ...
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-slaves-">sentinel slaves <master name=""></master> <a href="#sentinel-slaves-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
查看某个主节点下从节点的信息
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel slaves master1
1)  1) "name"
    2) "127.0.0.1:6380"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "6380"
    ...
2)  1) "name"
    2) "127.0.0.1:6381"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "6381"
    ...
3)  1) "name"
    2) "127.0.0.1:6383"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "6383"
    ...
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-sentinels-">sentinel sentinels <master name=""></master> <a href="#sentinel-sentinels-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
查看某个主节点下哨兵的信息，不包括当前使用哨兵
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel sentinels master1
1)  1) "name"
    2) "f1b42cce7da99809b392a51b366cde7b3b6f6048"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "26383"
    ...
2)  1) "name"
    2) "8b1933d36031e2b9ee581f8269ac4bd427bb6063"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "26382"
    ...
3)  1) "name"
    2) "29e2457f28a8fecd77f253b542f10523878c4e59"
    3) "ip"
    4) "127.0.0.1"
    5) "port"
    6) "26381"
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-get-master-addr-by-name-">sentinel get-master-addr-by-name <master name=""></master> <a href="#sentinel-get-master-addr-by-name-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
查看某个主节点的ip与port信息
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel get-master-addr-by-name master1
1) "127.0.0.1"
2) "6382"
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-reset-">sentinel reset <pattern></pattern> <a href="#sentinel-reset-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
重置匹配主节点的配置，清除主节点的相关状态（例如故障转移），重新发现从节点和哨兵节点
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel reset master1
(integer) 1
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-failover-">sentinel failover <master name=""></master> <a href="#sentinel-failover-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
对主节点进行强制故障转移
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel failover master1
OK
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-ckquorum-">sentinel ckquorum <master name=""></master> <a href="#sentinel-ckquorum-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
检查当前的可达哨兵节点数是否达到<code>quorum</code>个数，如果达不到则无法进行故障转移
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel ckquorum master1
OK 4 usable Sentinels. Quorum and failover authorization can be reached
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-flushconfig">sentinel flushconfig <a href="#sentinel-flushconfig" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
将哨兵节点的配置更新到磁盘
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel flushconfig
OK
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-remove-">sentinel remove <master name=""></master> <a href="#sentinel-remove-" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
取消当前哨兵节点对某个主节点的监控
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel remove master1
OK
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-monitor----">sentinel monitor <master name=""> <ip> <port> <quorum></quorum></port></ip></master> <a href="#sentinel-monitor----" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
对当前哨兵节点添加对某个主节点的监控
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -p 26380 sentinel monitor master1 127.0.0.1 6381 2
OK
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-set---">sentinel set <master name=""> <param /> <value></value></master> <a href="#sentinel-set---" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
动态修改哨兵的配置，只对当前哨兵生效。修改成功后会立即更新配置文件，不同于redis.conf需要执行config rewrite。
</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6380]# ./redis-cli -p 26380 sentinel set master1 quorum 3
OK
</pre></td></tr></tbody></table></code></div></div>

<h5 id="sentinel-is-master-down-by-addr">sentinel is-master-down-by-addr <a href="#sentinel-is-master-down-by-addr" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
Sentinel节点之间用来交换对主节点是否下线的判断，根据参数的不同，还可以作为Sentinel领导者选举的通信方式
</p>

<h2 id="原理">原理 <a href="#原理" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<h4 id="定时监控任务">定时监控任务 <a href="#定时监控任务" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<h5 id="1间隔10s">1.间隔10s <a href="#1间隔10s" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
每个sentinel通过主从节点获取info信息，更新拓扑结构。主要作用如下：
</p>

<ul>
  <li>通过主节点获取从节点信息，sentinel节点不需要显式配置从节点的原因</li>
  <li>自动感知新加入的从节点</li>
  <li>节点不可达或故障转移后，更新最新的拓扑信息</li>
</ul>

<p><img data-src="http://localhost:4000/img/2018-10-09-redis-sentinel/20181011165230.png?raw=https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images@f4e0354b674f65a53b8917f0f786ed2956898cc1true" alt="image" data-proofer-ignore></p>

<h5 id="2间隔2s">2.间隔2s <a href="#2间隔2s" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
每个sentinel节点向所有redis数据节点的<code>__sentinel__:hello</code>频道发送该sentinel节点的信息及主节点的信息，同时也订阅所有数据节点上的<code>__sentinel__:hello</code>频道来获取其他sentinel节点的信息与主节点信息。主要作用如下：
</p>

<ul>
  <li>发现新的sentinel节点，与它们建立连接</li>
  <li>sentinel节点之间交换主节点的状态，用于客观下线以及领导者选举的判断</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>#接收到的消息
[root@vagrant redis-6383]# ./redis-cli -p 6381 subscribe __sentinel__:hello
Reading messages... (press Ctrl-C to quit)
1) "subscribe"
2) "__sentinel__:hello"
3) (integer) 1
1) "message"
2) "__sentinel__:hello"
3) "127.0.0.1,26381,29e2457f28a8fecd77f253b542f10523878c4e59,7,master1,127.0.0.1,6381,7"
1) "message"
2) "__sentinel__:hello"
3) "127.0.0.1,26382,8b1933d36031e2b9ee581f8269ac4bd427bb6063,7,master1,127.0.0.1,6381,7"
1) "message"
2) "__sentinel__:hello"
3) "127.0.0.1,26383,f1b42cce7da99809b392a51b366cde7b3b6f6048,7,master1,127.0.0.1,6381,7"
1) "message"
2) "__sentinel__:hello"
3) "1.1.1.1,26380,699c1928d7ebe3b9f3a8395e824313e1e8f66a7e,7,master1,127.0.0.1,6381,7"
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>&lt;Sentinel节点IP&gt; &lt;Sentinel节点端口&gt; &lt;Sentinel节点runId&gt; &lt;Sentinel节点配置版本&gt;&lt;主节点名字&gt; &lt;主节点Ip&gt; &lt;主节点端口&gt; &lt;主节点配置版本&gt;
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="http://localhost:4000/img/2018-10-09-redis-sentinel/20181011170255.png?raw=https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images@f4e0354b674f65a53b8917f0f786ed2956898cc1true" alt="image" data-proofer-ignore></p>

<h5 id="3间隔1s">3.间隔1s <a href="#3间隔1s" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
每个sentinel节点会向主节点、从节点、其余sentinel节点发送一条ping命令做一次心跳检测，来确认这些节点当前是否可达。
</p>

<p><img data-src="http://localhost:4000/img/2018-10-09-redis-sentinel/20181011172218.png?raw=https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images@f4e0354b674f65a53b8917f0f786ed2956898cc1true" alt="image" data-proofer-ignore></p>

<h4 id="主观下线与客观下线">主观下线与客观下线 <a href="#主观下线与客观下线" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<h5 id="主观下线">主观下线 <a href="#主观下线" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
当sentinel每隔1秒对主节点、从节点、其他sentinel节点发送ping命令做心跳检测时，如果这些节点超过<code>down-after-milliseconds</code>没有进行有效回复，sentinel节点就认为此节点主观下线。
</p>

<h5 id="客观下线">客观下线 <a href="#客观下线" class="anchor"><i class="fas fa-hashtag"></i></a></h5></h5>

<p>
当主观下线的节点为主节点时，sentinel会向其他sentinel节点发送<code>sentinel ismaster-down-by-addr</code>命令来获取其他sentinel节点对主节点的判断，如果超过<code>quorum</code>个sentinel节点认为主节点为主观下线，则sentinel会认为主节点为客观下线。
</p>

<p>
命令说明：<code>sentinel is-master-down-by-addr {ip} {port} {current_epoch} {runid}</code>
</p>

<ul>
  <li>ip：主节点ip</li>
  <li>port：主节点端口</li>
  <li>current_epoch：当前配置纪元</li>
  <li>runid：”*“交换对主节点下线的判定，否则当runid等于当前Sentinel节点的runid时，作用是当前Sentinel节点希望目标Sentinel节点同意自己成为领导者的请求</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>[root@vagrant redis-6383]# ./redis-cli -h 127.0.0.1 -p 26380 sentinel is-master-down-by-addr 127.0.0.1 6381 7 '*'
1) (integer) 0
2) "*"
3) (integer) 0
</pre></td></tr></tbody></table></code></div></div>

<p>
返回结果说明：
</p>

<ul>
  <li>down_state：目标Sentinel节点对于主节点的下线判断，1是下线，0是在线</li>
  <li>leader_runid：当leader_runid等于“*”时，代表返回结果是用来做主节点是否不可达判断的，当leader_runid等于具体的runid，代表目标节点同意runid成为领导者</li>
  <li>领导者纪元</li>
</ul>

<h4 id="sentinel-leader选举">sentinel leader选举 <a href="#sentinel-leader选举" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p>
实际完成故障转移只需要一个sentinel节点，redis使用了<a target="_blank" href="https://raft.github.io/">raft</a>算法来实现leader的选举，基本上最先完成客观下线的节点就是leader，大致过程如下：
</p>

<ul>
  <li>每个在线的Sentinel节点都有资格成为领导者，当它确认主节点主观下线时候，会向其他Sentinel节点发送sentinel is-master-down-by-addr命令，要求将自己设置为领导者</li>
  <li>收到命令的Sentinel节点，如果没有同意过其他Sentinel节点的sentinelis-master-down-by-addr命令，将同意该请求，否则拒绝</li>
  <li>如果该Sentinel节点发现自己的票数已经大于等于max（quorum，num（sentinels）/2+1），那么它将成为领导者</li>
  <li>如果此过程没有选举出领导者，将进入下一次选举</li>
</ul>

<h4 id="故障转移">故障转移 <a href="#故障转移" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p>
sentinel leader执行故障转移的大致流程如下：
</p>

<p>
1.在从节点中选出一个节点作为新的主节点
</p>

<ul>
  <li>过滤：“不健康”（主观下线、断线）、5秒内没有回复过Sentinel节点ping响应、与主节点失联超过down-after-milliseconds*10秒</li>
  <li>选择slave-priority（从节点优先级）最高的从节点列表，如果存在则返回，不存在则继续</li>
  <li>选择复制偏移量最大的从节点（复制的最完整），如果存在则返回，不存在则继续</li>
  <li>选择runid最小的从节点</li>
</ul>

<p><img data-src="http://localhost:4000/img/2018-10-09-redis-sentinel/20181012135652.png?raw=https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images@f4e0354b674f65a53b8917f0f786ed2956898cc1true" alt="image" data-proofer-ignore></p>

<p>
2.sentinel leader对选出来的节点执行<code>slaveof no one</code>让其变为主节点
</p>

<p>
3.sentinel leader向剩余的从节点发送命令，让它们成为新主节点的从节点，复制规则和parallel-syncs参数有关
</p>

<p>
4.sentinel节点集合会将原来的主节点更新为从节点，并保持着对其关注，当其恢复后命令它去复制新的主节点
</p>

<h2 id="参考资料">参考资料 <a href="#参考资料" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p><a href="https://github.com/antirez/redis/blob/unstable/sentinel.conf">sentinel.conf</a></p>

<p><a href="https://github.com/antirez/redis-doc/blob/master/topics/sentinel.md">sentinel topic</a></p>

<p><a href="http://item.jd.com/12121730.html?spm=1.1.1">redis开发与运维</a></p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/redis/"
          class="post-tag no-text-decoration" >redis</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <!-- <a href=""> -->
          zwtisme
        <!-- </a> -->
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <!-- <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=redis的哨兵 - Chirpy&url=http://localhost:4000/posts/redis-sentinel/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=redis的哨兵 - Chirpy&u=http://localhost:4000/posts/redis-sentinel/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=redis的哨兵 - Chirpy&url=http://localhost:4000/posts/redis-sentinel/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        title-succeed="Link copied successfully!">
    </i>

  </span> -->
  <i id="copy-link" class="fa-fw fas fa-link small"
    data-toggle="tooltip" data-placement="top"
    title="Copy link"
    title-succeed="Link copied successfully!">
  </i>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/redis-cluster/">redis的集群</a></li>
      
        
        
        
      <li><a href="/posts/11-rabbitmq-study-configuration/">RabbitMQ学习-配置</a></li>
      
        
        
        
      <li><a href="/posts/14-rabbitmq-study-queue-data-sync/">RabbitMQ学习-队列数据同步</a></li>
      
        
        
        
      <li><a href="/posts/git-study-introduction/">Git学习-入门</a></li>
      
        
        
        
      <li><a href="/posts/2-rabbitmq-study-problems/">RabbitMQ学习-遇到的问题</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/php/">php</a>
    
      
      <a class="post-tag" href="/tags/rabbitmq/">rabbitmq</a>
    
      
      <a class="post-tag" href="/tags/redis/">redis</a>
    
      
      <a class="post-tag" href="/tags/laravel/">laravel</a>
    
      
      <a class="post-tag" href="/tags/mysql/">mysql</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/git/">git</a>
    
      
      <a class="post-tag" href="/tags/http/">http</a>
    
      
      <a class="post-tag" href="/tags/swoole/">swoole</a>
    
      
      <a class="post-tag" href="/tags/tcp-ip/">tcp/ip</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
      
        
        <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/redis-cluster/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2018-10-12 15:30:00 +0800"
    >Oct 12, 2018</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>redis的集群</h3>
            <div class="text-muted small">
              <p>
                





                
  介绍如果搭建redis集群，以及如何对集群进行扩展与收缩


前言


为了提高缓存服务器的写请求处理能力与数据存储能力可使用redis集群，根据实际业务情况对集群进行扩展与收缩


准备工作


由于机器的限制，此文章中的redis实例都是在一台机器上启动的，通过不同的port来模拟不同的redis实例。


1
2
3
4
5
6
7
[root@vagrant redis-638...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/redis-pconnect-connect/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2018-06-06 20:50:00 +0800"
    >Jun  6, 2018</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>redis中pconnect与connect</h3>
            <div class="text-muted small">
              <p>
                





                
  介绍phpredis模块中，pconnect与connect连接的区别。


概述

1.connect


每次connect都会新建一个tcp连接；脚本运行结束之后自动断开连接。


2.pconnect


持久连接，标识id：
1.host + port + timeout
2.host + persistent_id
3.unix socket + timeout



每次...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/redis-online-wrong/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->





<em class="timeago small"
    date="2018-08-03 18:00:00 +0800"
    >Aug  3, 2018</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>redis上线的问题</h3>
            <div class="text-muted small">
              <p>
                





                
  记一次上线后redis出现的问题及处理方法。


前言


在此项目之前，有一个项目用到了redis，那个项目中的key数较少（2W左右），目前没出现问题（如果之后key数上升，有些地方也需要进行调整），使自己的判断出现了问题，以为redis是可以随便用的，然后就产生了下面的问题。


问题及处理

1.key数的增长异常


原因：因为系统采用redis作为session的存储，在每...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


      
        
        <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/redis-master-slave/" class="btn btn-outline-primary"
    prompt="Older">
    <p>redis的主从</p>
  </a>
  

  
  <a href="/posts/redis-cluster/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>redis的集群</p>
  </a>
  

</div>

      
        
        <!--  The comments switcher -->


      
    </div>
  </div>
</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://twitter.com/username">your_full_name</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        <!-- Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         theme. -->

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/php/">php</a>
    
      
      <a class="post-tag" href="/tags/rabbitmq/">rabbitmq</a>
    
      
      <a class="post-tag" href="/tags/redis/">redis</a>
    
      
      <a class="post-tag" href="/tags/laravel/">laravel</a>
    
      
      <a class="post-tag" href="/tags/mysql/">mysql</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/git/">git</a>
    
      
      <a class="post-tag" href="/tags/http/">http</a>
    
      
      <a class="post-tag" href="/tags/swoole/">swoole</a>
    
      
      <a class="post-tag" href="/tags/tcp-ip/">tcp/ip</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>


 -->


  </body>

</html>

